// Generated by CoffeeScript 2.5.1
(function() {
  define(['cmx/gizmo'], function(Gizmo) {
    var Controller, instanceNumber;
    instanceNumber = 0;
    return Controller = class Controller {
      constructor(scenes = []) {
        this.scenes = scenes;
        this.instanceNumber = ++instanceNumber;
        this.undoStack = [];
        this.redoStack = [];
      }

      makeEditable() {
        var i, len, ref, scene, sceneModel;
        ref = this.scenes;
        for (i = 0, len = ref.length; i < len; i++) {
          sceneModel = ref[i];
          scene = sceneModel.view;
          scene.buildGizmos();
          $(scene.rootElement).addClass("cmx-editable");
        }
        return $("html").bind("click", (event) => {
          if (d3.select(event.target).parents("cmx-selected").length > 0) {
            return;
          }
          return this.unselectAll();
        });
      }

      unselectAll() {
        if (!this.previousSelection) {
          return;
        }
        this.previousSelection.unselect();
        this.previousSelection = void 0;
        $(".cmx-has-selected-gizmo").removeClass("cmx-has-selected-gizmo");
        return $("html").removeClass("cmx-active-selection");
      }

      registerUndo(fn) {
        return this.undoStack.push(fn);
      }

      undo() {
        var action;
        if (!this.undoStack.length) {
          return;
        }
        action = this.undoStack.pop();
        return action();
      }

      registerRedo(fn) {
        return this.redoStack.push(fn);
      }

      redo() {
        var action;
        if (!this.redoStack.length) {
          return;
        }
        action = this.redoStack.pop();
        return action();
      }

    };
  });

}).call(this);
